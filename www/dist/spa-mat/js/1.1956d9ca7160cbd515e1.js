webpackJsonp([1],{"+cKO":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.maxValue=t.minValue=t.and=t.or=t.url=t.sameAs=t.requiredUnless=t.requiredIf=t.required=t.minLength=t.maxLength=t.macAddress=t.ipAddress=t.email=t.between=t.numeric=t.alphaNum=t.alpha=void 0;var r=q(a("FWhV")),s=q(a("PKmV")),o=q(a("hbkP")),n=q(a("3Ro/")),i=q(a("6rz0")),l=q(a("HSVw")),u=q(a("HM/u")),d=q(a("qHXR")),c=q(a("4ypF")),f=q(a("4oDf")),p=q(a("lEk1")),m=q(a("6+Xr")),h=q(a("L6Jx")),v=q(a("7J6f")),g=q(a("Y18q")),b=q(a("bXE/")),k=q(a("aYrh")),_=q(a("xJ3U"));function q(e){return e&&e.__esModule?e:{default:e}}t.alpha=r.default,t.alphaNum=s.default,t.numeric=o.default,t.between=n.default,t.email=i.default,t.ipAddress=l.default,t.macAddress=u.default,t.maxLength=d.default,t.minLength=c.default,t.required=f.default,t.requiredIf=p.default,t.requiredUnless=m.default,t.sameAs=h.default,t.url=v.default,t.or=g.default,t.and=b.default,t.minValue=k.default,t.maxValue=_.default},"3Ro/":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("URu4");t.default=function(e,t){return(0,r.withParams)({type:"between",min:e,max:t},function(a){return!(0,r.req)(a)||(!/\s/.test(a)||a instanceof Date)&&+e<=+a&&+t>=+a})}},"4oDf":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("URu4");t.default=(0,r.withParams)({type:"required"},r.req)},"4ypF":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("URu4");t.default=function(e){return(0,r.withParams)({type:"minLength",min:e},function(t){return!(0,r.req)(t)||(0,r.len)(t)>=e})}},"6+Xr":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("URu4");t.default=function(e){return(0,r.withParams)({type:"requiredUnless",prop:e},function(t,a){return!!(0,r.ref)(e,this,a)||(0,r.req)(t)})}},"6rz0":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("URu4");t.default=(0,r.regex)("email",/(^$|^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$)/)},"7J6f":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("URu4");t.default=(0,r.regex)("url",/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i)},FWhV:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("URu4");t.default=(0,r.regex)("alpha",/^[a-zA-Z]*$/)},"HM/u":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("URu4");t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:":";return(0,r.withParams)({type:"macAddress"},function(t){if(!(0,r.req)(t))return!0;if("string"!=typeof t)return!1;var a="string"==typeof e&&""!==e?t.split(e):12===t.length||16===t.length?t.match(/.{2}/g):null;return null!==a&&(6===a.length||8===a.length)&&a.every(s)})};var s=function(e){return e.toLowerCase().match(/^[0-9a-f]{2}$/)}},HSVw:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("URu4");t.default=(0,r.withParams)({type:"ipAddress"},function(e){if(!(0,r.req)(e))return!0;if("string"!=typeof e)return!1;var t=e.split(".");return 4===t.length&&t.every(s)});var s=function(e){if(e.length>3||0===e.length)return!1;if("0"===e[0]&&"0"!==e)return!1;if(!e.match(/^\d+$/))return!1;var t=0|+e;return t>=0&&t<=255}},L6Jx:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("URu4");t.default=function(e){return(0,r.withParams)({type:"sameAs",eq:e},function(t,a){return t===(0,r.ref)(e,this,a)})}},PKmV:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("URu4");t.default=(0,r.regex)("alphaNum",/^[a-zA-Z0-9]*$/)},URu4:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.regex=t.ref=t.len=t.req=t.withParams=void 0;var r,s=a("mpcv"),o=(r=s)&&r.__esModule?r:{default:r};t.withParams=o.default;var n=t.req=function(e){if(Array.isArray(e))return!!e.length;if(void 0===e||null===e||!1===e)return!1;if(e instanceof Date)return!isNaN(e.getTime());if("object"==typeof e){for(var t in e)return!0;return!1}return!!String(e).length};t.len=function(e){return Array.isArray(e)?e.length:"object"==typeof e?Object.keys(e).length:String(e).length},t.ref=function(e,t,a){return"function"==typeof e?e.call(t,a):a[e]},t.regex=function(e,t){return(0,o.default)({type:e},function(e){return!n(e)||t.test(e)})}},Y18q:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("URu4");t.default=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.withParams)({type:"or"},function(){for(var e=this,a=arguments.length,r=Array(a),s=0;s<a;s++)r[s]=arguments[s];return t.length>0&&t.reduce(function(t,a){return t||a.apply(e,r)},!1)})}},aYrh:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("URu4");t.default=function(e){return(0,r.withParams)({type:"minValue",min:e},function(t){return!(0,r.req)(t)||(!/\s/.test(t)||t instanceof Date)&&+t>=+e})}},"bXE/":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("URu4");t.default=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.withParams)({type:"and"},function(){for(var e=this,a=arguments.length,r=Array(a),s=0;s<a;s++)r[s]=arguments[s];return t.length>0&&t.reduce(function(t,a){return t&&a.apply(e,r)},!0)})}},hWMd:function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"\n.report-tree {\n  position: absolute;\n  width: 600px;\n  height: auto;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n}\n.report-tree-select {\n  /*width: 160px;*/\n  position: absolute;\n  right: 15px;\n  top: -10px;\n  margin: 0;\n}\n.btn-create {\n  position: relative;\n  top: -15px;\n  left: 15px;\n  display: inline-block;\n}\n.btn-save {\n  margin-top: 10px;\n}\n.form-field {\n  margin: 12px 0;\n}\n.q-table-container {\n  box-shadow: none;\n}\n.task-table {\n  border: none;\n}\n.q-table-top {\n  position: absolute;\n  top: -45px;\n  right: 50px;\n  min-height: 0;\n  padding: 0;\n}\n",""])},hbkP:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("URu4");t.default=(0,r.regex)("numeric",/^[0-9]*$/)},lEk1:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("URu4");t.default=function(e){return(0,r.withParams)({type:"requiredIf",prop:e},function(t,a){return!(0,r.ref)(e,this,a)||(0,r.req)(t)})}},mcif:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("+cKO"),s=a("7109"),o={name:"REPORT",data:function(){return{isDeploy:!1,isEdit:!1,isAdmin:!1,showUser:!1,historyTask:!1,loading:!1,loadingProject:!1,createTaskModal:!1,createProjectModal:!1,weekOfYear:"",user:{},select:"2018-03-01",selectOptions:[{label:"2018-03-01",value:"2018-03-01"},{label:"2018-02-20",value:"2018-02-20"},{label:"2018-02-13",value:"2018-02-13"}],periodOptions:[],projectsMock:[{id:1,name:"Portal"},{id:2,name:"Admin"},{id:3,name:"Mini Programs"}],projectOptions:[],statusOptions:[{label:"开发中",value:0},{label:"已提测",value:1},{label:"已上线",value:2}],progressOptions:[{label:"0%",value:0},{label:"10%",value:10},{label:"20%",value:20},{label:"30%",value:30},{label:"40%",value:40},{label:"50%",value:50},{label:"60%",value:60},{label:"70%",value:70},{label:"80%",value:80},{label:"90%",value:90},{label:"100%",value:100}],taskForm:{id:"",name:"",user_id:"",project_id:"",progress:0,status:0,remark:"",period:""},projectForm:{name:""},errMessage:{requireInfo:"必填",maxInfo:"任务名称不宜超过30个字符"},columns:[{name:"任务名称",label:"任务名称",field:"name",align:"left"},{name:"状态",label:"状态",field:"statusZh"},{name:"进度",label:"进度",field:"progressPercent"}],columnsLeader:[{name:"任务名称",label:"任务名称",field:"name",align:"left"},{name:"状态",label:"状态",field:"statusZh"},{name:"进度",label:"进度",field:"progressPercent"},{name:"责任人",label:"责任人",field:"username"}],tableDataMock:[{project:"门户",selected:[],data:[{id:1,name:"medadwa",progress:100,status:0},{id:2,name:"medadwa2",progress:60,status:1},{id:3,name:"medadwasada",progress:10,status:2},{id:11,name:"medadwa",progress:100,status:0},{id:12,name:"medadwa2",progress:60,status:1},{id:13,name:"medadwasada",progress:10,status:2},{id:21,name:"medadwa",progress:100,status:0},{id:22,name:"medadwa2",progress:60,status:1},{id:23,name:"medadwasada",progress:10,status:2}]},{project:"开发者中心",selected:[],data:[{id:4,name:"medadwa",progress:100,status:0},{id:5,name:"medadwa2",progress:60,status:1},{id:6,name:"medadwasada",progress:10,status:2}]}],tableData:[{project:"暂无数据",selected:[],data:[]}]}},validations:{taskForm:{name:{required:r.required,maxLength:Object(r.maxLength)(30)},project_id:{required:r.required},progress:{required:r.required},status:{required:r.required},remark:{}},projectForm:{name:{required:r.required}}},created:function(){this.initFormData()},watch:{select:function(){this.weekOfYear=this.select,this.getReportData()}},methods:{initFormData:function(){this.user=JSON.parse(localStorage.getItem("user")),this.isAdmin=0===this.user.role,this.showUser=2!==this.user.role,this.taskForm.user_id=this.user._id,this.checkFinished(),this.getWeekOfYear(),this.renderPeriods(),this.getProjectsList()},checkFinished:function(){var e=this;e.$axios.post("/api/isFinished",{user_id:e.user._id}).then(function(t){0===t.data.code&&(e.$q.notify({message:t.data.message,timeout:2e3,type:"positive",position:"top"}),e.getReportData())}).catch(function(t){e.handleError(t)})},renderPeriods:function(){for(var e=parseInt(this.weekOfYear);e>8;e--)this.periodOptions.push({label:(this.isAdmin?"":this.user.name+" ")+"第"+e+"期周报",value:e});this.select=parseInt(this.weekOfYear)},getProjectsList:function(){var e=this;e.projectOptions=[],e.$axios.get("/api/getProjectList").then(function(t){if(0===t.data.code)for(var a=t.data.data,r=0,s=a.length;r<s;r++)e.projectOptions.push({label:a[r].name,value:a[r]._id})}).catch(function(t){e.handleError(t)})},getReportData:function(){var e=this,t={period:e.weekOfYear,username:e.user.name,userrole:e.user.role,userid:e.user._id};e.$axios.post("/api/getTaskListByPeriod",t).then(function(t){0===t.data.code&&(t.data.data.length>0?e.tableData=t.data.data:0===t.data.data.length&&(e.$q.dialog({title:"提示",message:"第"+e.weekOfYear+"期周报暂无数据"}),e.getWeekOfYear(),e.select=parseInt(e.weekOfYear)))}).catch(function(t){e.handleError(t)})},getWeekOfYear:function(){var e=s.E.formatDate(Date.now(),"w");this.weekOfYear=0===s.E.formatDate(Date.now(),"d")?e+1:e},createTask:function(){this.createTaskModal=!0},saveTask:function(){var e=this;e.$v.taskForm.$touch(),e.$v.taskForm.$error||(2===e.taskForm.status&&(e.taskForm.progress=100),e.loading=!0,e.$axios.post(e.isEdit?"/api/task/edit":"/api/task/add",e.taskForm).then(function(t){0===t.data.code?(e.getReportData(),setTimeout(function(){e.loading=!1,e.createTaskModal=!1,e.isEdit=!1,e.resetForm()},1e3)):(e.loading=!1,e.$q.dialog({title:"Error",message:t.data.message}))}).catch(function(t){e.handleError(t)}))},editTask:function(e){this.taskForm.id=e[0].id,this.taskForm.name=e[0].name,this.taskForm.period=e[0].period,this.taskForm.progress=e[0].progress,this.taskForm.project_id=e[0].project._id,this.taskForm.status=parseInt(e[0].status),this.taskForm.user_id=this.user._id,this.taskForm.remark=e[0].remark,this.createTaskModal=!0,this.isEdit=!0},deleteTask:function(e){var t=this;this.$q.dialog({title:"确认",message:"确认删除该任务吗?",ok:"删除",cancel:"再考虑考虑"}).then(function(){t.$axios.post("/api/task/del",{id:e[0].id,user_id:t.user._id}).then(function(e){0===e.data.code?(t.getReportData(),t.$q.notify({message:"已删除,这下真没了!",timeout:2e3,type:"positive",position:"top"})):(t.loading=!1,t.$q.dialog({title:"Error",message:e.data.message}))}).catch(function(e){t.handleError(e)})}).catch(function(){t.$q.notify({message:"看来你是一个很谨慎的人!",timeout:2e3,type:"info",position:"top"})})},createProject:function(){this.createProjectModal=!0},saveProject:function(){var e=this;e.$v.projectForm.$touch(),e.$v.projectForm.$error||(e.loadingProject=!0,e.$axios.post("/api/project/add",e.projectForm).then(function(t){0===t.data.code?(e.getProjectsList(),setTimeout(function(){e.loadingProject=!1,e.createProjectModal=!1,e.projectForm.name=""},1e3)):(e.loading=!1,e.$q.dialog({title:"Error",message:t.data.message}))}).catch(function(t){e.handleError(t)}))},exportExcel:function(){var e=this;this.$axios.post("/api/export",{period:this.weekOfYear}).then(function(e){0===e.data.code&&window.open("http://localhost:1234/"+e.data.data.url)}).catch(function(t){e.$q.notify({message:t.response.data.message,timeout:2e3,type:"info",position:"top"})})},resetForm:function(){this.taskForm.id="",this.taskForm.name="",this.taskForm.project_id="",this.taskForm.progress=0,this.taskForm.status=0,this.taskForm.remark="",this.taskForm.create_date="",this.taskForm.period="",this.isEdit=!1},handleError:function(e){var t="jwt expired"===e.response.data.error;500!==e.response.status?this.$q.dialog({title:e.response.status+"",message:t?"token已过期,重新登录":e.response.data.error}).then(function(){t&&(window.location.href="/login")}):(this.loading=!1,this.loadingProject=!1,this.$q.dialog({title:e.response.status+"",message:e.response.data.message}))}}},n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"report-tree"},[a("q-select",{staticClass:"report-tree-select",attrs:{options:e.periodOptions},model:{value:e.select,callback:function(t){e.select=t},expression:"select"}}),e._v(" "),e.isAdmin?a("q-btn",{staticClass:"btn-create",attrs:{icon:"file download",label:"EXPORT"},on:{click:e.exportExcel}}):e._e(),e._v(" "),e.showUser?a("q-btn",{staticClass:"btn-create",attrs:{icon:"add",label:"PROJECT"},on:{click:e.createProject}}):e._e(),e._v(" "),e.historyTask?e._e():a("q-btn",{staticClass:"btn-create",attrs:{icon:"add",label:"TASK"},on:{click:e.createTask}}),e._v(" "),e._l(e.tableData,function(t,r){return a("q-collapsible",{key:r,attrs:{popup:"",icon:"layers",label:t.project}},[a("div",[a("q-table",{attrs:{data:t.data,columns:e.showUser?e.columnsLeader:e.columns,selection:"single",selected:t.selected,color:"primary","no-data-label":"暂无数据","table-class":"task-table"},on:{"update:selected":function(a){e.$set(t,"selected",a)}},scopedSlots:e._u([{key:"top-selection",fn:function(r){return[a("q-btn",{attrs:{color:"positive",flat:"",icon:"mode edit",label:"编辑"},on:{click:function(a){e.editTask(t.selected)}}}),e._v(" "),a("q-btn",{attrs:{color:"negative",flat:"",delete:"",icon:"delete",label:"删除"},on:{click:function(a){e.deleteTask(t.selected)}}})]}}])})],1)])}),e._v(" "),a("q-modal",{attrs:{"content-css":{padding:"50px",minWidth:"500px"}},on:{hide:e.resetForm},model:{value:e.createTaskModal,callback:function(t){e.createTaskModal=t},expression:"createTaskModal"}},[e.isEdit?e._e():a("div",{staticClass:"q-display-1 q-mb-md"},[e._v("创建任务")]),e._v(" "),e.isEdit?a("div",{staticClass:"q-display-1 q-mb-md"},[e._v("编辑任务")]):e._e(),e._v(" "),a("div",[a("q-field",{staticClass:"form-field",attrs:{error:e.$v.taskForm.name.$error,"error-label":e.$v.taskForm.name.maxLength?e.errMessage.requireInfo:e.errMessage.maxInfo}},[a("q-input",{attrs:{"float-label":"任务名称"},on:{input:e.$v.taskForm.name.$touch},model:{value:e.taskForm.name,callback:function(t){e.$set(e.taskForm,"name",t)},expression:"taskForm.name"}})],1),e._v(" "),a("q-field",{staticClass:"form-field",attrs:{error:e.$v.taskForm.project_id.$error,"error-label":e.errMessage.requireInfo}},[a("q-select",{attrs:{"float-label":"所属项目",options:e.projectOptions},model:{value:e.taskForm.project_id,callback:function(t){e.$set(e.taskForm,"project_id",t)},expression:"taskForm.project_id"}})],1),e._v(" "),a("q-field",{staticClass:"form-field",attrs:{error:e.$v.taskForm.status.$error,"error-label":e.errMessage.requireInfo}},[a("q-select",{attrs:{"float-label":"状态",options:e.statusOptions},model:{value:e.taskForm.status,callback:function(t){e.$set(e.taskForm,"status",t)},expression:"taskForm.status"}})],1),e._v(" "),a("q-field",{staticClass:"form-field",attrs:{error:e.$v.taskForm.progress.$error,"error-label":e.errMessage.requireInfo}},[2!=e.taskForm.status?a("q-select",{attrs:{"float-label":"进度",options:e.progressOptions},model:{value:e.taskForm.progress,callback:function(t){e.$set(e.taskForm,"progress",t)},expression:"taskForm.progress"}}):e._e()],1),e._v(" "),a("q-field",{staticClass:"form-field",attrs:{error:e.$v.taskForm.remark.$error,"error-label":e.errMessage.requireInfo}},[a("q-input",{attrs:{"float-label":"备注"},on:{input:e.$v.taskForm.remark.$touch},model:{value:e.taskForm.remark,callback:function(t){e.$set(e.taskForm,"remark",t)},expression:"taskForm.remark"}})],1)],1),e._v(" "),a("q-btn",{staticClass:"btn-save",attrs:{loading:e.loading,color:"primary"},on:{click:e.saveTask}},[e._v("\n            保存\n            "),a("q-spinner-hourglass",{attrs:{slot:"loading",size:"20px"},slot:"loading"}),e._v(" "),a("span",{attrs:{slot:"loading"},slot:"loading"},[e._v("Loading...")])],1)],1),e._v(" "),a("q-modal",{attrs:{"content-css":{padding:"50px",minWidth:"500px"}},model:{value:e.createProjectModal,callback:function(t){e.createProjectModal=t},expression:"createProjectModal"}},[a("div",{staticClass:"q-display-1 q-mb-md"},[e._v("创建项目")]),e._v(" "),a("div",[a("q-field",{staticClass:"form-field",attrs:{error:e.$v.projectForm.name.$error,"error-label":"Required"}},[a("q-input",{attrs:{"float-label":"项目名称"},on:{input:e.$v.projectForm.name.$touch},model:{value:e.projectForm.name,callback:function(t){e.$set(e.projectForm,"name",t)},expression:"projectForm.name"}})],1),e._v(" "),a("q-btn",{staticClass:"btn-save",attrs:{loading:e.loadingProject,color:"primary"},on:{click:e.saveProject}},[e._v("\n                保存\n                "),a("q-spinner-hourglass",{attrs:{slot:"loading",size:"20px"},slot:"loading"}),e._v(" "),a("span",{attrs:{slot:"loading"},slot:"loading"},[e._v("Loading...")])],1)],1)])],2)},i=[];n._withStripped=!0;var l=a("XyMi"),u=!1;var d=function(e){u||a("tuCL")},c=Object(l.a)(o,n,i,!1,d,null,null);c.options.__file="src/components/dashboard.vue";t.default=c.exports},mpcv:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("JVqD").withParams;t.default=r},qHXR:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("URu4");t.default=function(e){return(0,r.withParams)({type:"maxLength",max:e},function(t){return!(0,r.req)(t)||(0,r.len)(t)<=e})}},tuCL:function(e,t,a){var r=a("hWMd");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,a("rjj0").default)("ec8c50de",r,!1,{})},xJ3U:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("URu4");t.default=function(e){return(0,r.withParams)({type:"maxValue",max:e},function(t){return!(0,r.req)(t)||(!/\s/.test(t)||t instanceof Date)&&+t<=+e})}}});